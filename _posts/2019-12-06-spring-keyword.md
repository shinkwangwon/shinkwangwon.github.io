---
layout: post
title: "Spring 용어 정리"
tags: [spring]
comments: true
date: 2019-12-06
---

### IoC (Inversion Of Controller) : 제어의 역전
- 먼저 일반적인 프로그램의 흐름은 main()메소드와 같이 프로그램이 시작되는 지점에서 다음에 사용할 오브젝트를 결정하고, 결정한 오브젝트를 생성하고, 만들어진 오브젝트에 있는 메소드를 호출하는 식의 작업이 반복된다. 이런 프로그램 구조에서 각 오브젝트는 프로그램 흐름을 결정하거나 사용할 오브젝트를 구성하는 작업에 능동적으로 참여한다. 예를 들어 main() 메소드에서 User정보를 가져오기 위한 UserDao 클래스의 인스턴스를 new UserDao(); 라는 식으로 생성하고, 만들어진 userDao객체의 getUser()와 같은 메소드를 호출하여 User를 조회하곤 한다. 이렇게 모든 오브젝트가 능동적으로 자신이 사용할 클래스를 결정하고 언제 어떻게 그 오브젝트를 만들지 스스로 관장한다. 즉, 모든 종류의 작업을 사용하는 쪽에서 제어하는 구조가 일반적인 프로그래밍 방식이다.
- IoC는 이런 제어 흐름의 개념을 거꾸로 뒤집는 것이다. 제어의 역전에서는 오브젝트가 자신이 사용할 오브젝트를 스스로 선택하지 않는다. 당연히 생성하지도 않는다. 모든 제어 권한을 자신이 아닌 다른 대상하게 위임하는 것이다. 스프링에서는 이러한 제어를 담당하는 것을 IoC컨테이너, 빈 팩토리, 애플리케이션 컨텍스트 등등으로 표현한다. IoC는 DI(Dependency Injection)와 함께 사용된다.
- **개발자가 직접 객체를 생성하고 관리하는 것이 아니라, 객체의 생성, 생명주기 관리 등에 대한 제어권을 스프링 컨테이너에게 위임하는 것을 말한다.**

### DI (Dependency Injection) : 의존관계 주입
- **각 오브젝트 사이의 의존관계를 빈 설정정보를 바탕으로 컨테이너가 자동으로 연결해주는 것을 말한다.**
- **오브젝트를 기능 별로 분리해두고 인터페이스를 통해 느슨하게 연결해 놓은 후에, 실제 사용할 대상을 컨테이너가 주입시켜주는 것을 말한다.**
- 의존관계 주입은 아래 3가지 조건을 충족하는 작업이다. 
  * 클래스 모델이나 코드에는 런타임 시점의 의존관계가 드러나지 않는다. 그러기 위해서는 인터페이스에만 의존하고 있어야 한다.
  * 런타임 시점의 의존관계는 컨테이너나 팩토리 같은 제 3의 존재가 결정한다.
  * 의존관계는 사용할 오브젝트에 대한 레퍼런스를 외부에서 제공(주입)해줌으로써 만들어진다.

### 빈 (bean)
- 빈 또는 빈오브젝트는 스프링이 Ioc방식으로 관리하는 오브젝트라는 뜻이다. 관리 되는 오브젝트라고 부르기도 한다. 주의할 점은 스프링을 사용하는 애플리케이션에서 만들어지는 모든 오브젝트가 다 빈은 아니라는 사실이다. 그 중에서 스프링이 직접 그 생성과 제어를 담당하는 오브젝트만을 빈이라고 한다.

### 빈 팩토리 (bean factory)
- 스프링의 IoC를 담당하는 핵심 컨테이너를 가리킨다. 빈을 등록하고, 생성하고, 조회하고 돌려주고, 그 외에 부가적인 빈을 관리하는 기능을 담당한다. 보통은 이 빈 팩토리를 바로 사용하지 않고 이를 확장한 애플리케이션 컨텍스트를 이용한다. BeanFactory라고 붙여쓰면 빈 팩토리가 구현하고 있는 가장 기본적인 인터페이스의 이름이 된다. 이 인터페이스에 getBean()과 같은 메소드가 정의되어 있다.

### 애플리케이션 컨텍스트 (application context)
- 빈 팩토리를 확장한 IoC 컨테이너다. 빈을 등록하고 관리하는 기본적인 기능은 빈 팩토리와 동일하다. 여기에 스프링이 제공하는 각종 부가 서비스를 추가로 제공한다. 빈 팩토리라고 부를 때는 주로 빈의 생성과 제어의 관점에서 이야기하는 것이고, 애플리케이션 컨텍스트라고 할 때는 스프링이 제공하는 애플리케이션 지원 기능을 모두 포함해서 이야기하는 것이라고 보면 된다. 스프링에서는 애플리케이션 컨텍스트라는 용어를 빈 팩토리보다 더 많이 사용한다. ApplicationContext라고 붙여쓰면 애플리케이션 컨텍스트가 구현해야 하는 기본 인터페이스를 가리킨다. ApplicationContext는 BeanFactory를 상속한다.

### 설정정보/ 설정메타정보 (configuration metadata)
- 스프링의 설정정보란 애플리케이션 컨텍스트 또는 빈 팩토리가 IoC를 적용하기 위해 사용하는 메타정보를 말한다. 실제로 스프링의 설정정보는 컨테이너에 어떤 기능을 세팅하거나 조정하는 경우에도 사용하지만, 그보다는 IoC컨테이너에 의해 관리되는 애플리케이션 오브젝트를 생성하고 구성할 때 사용된다.애플리케이션의 형상정보라고 부르기도 한다.

### 컨테이너 또는 IoC컨테이너
- IoC방식으로 빈을 관리한다는 의미에서 애플리케이션 컨텍스트나 빈 팩토리를 컨테이너 또는 IoC컨테이너라고도 한다. 후자는 주로 빈 팩토리의 관점에서 이야기 하는 것이고, 그냥 컨테이너 또는 스프링 컨테이너라고 할때는 애플리케이션 컨텍스트를 가리키는 것이라고 보면 된다. 컨테이너라는 말 자체가 IoC의 개념을 담고 있기 때문에 이름이 긴 애플리케이션 컨텍스트 대신에 스프링 컨테이너라고 부르는 걸 선호하는 사람들도 있다. 또 컨테이너라는 말은 애플리케이션 컨텍스트보다 추상적인 표현이기도 하다. 애플리케이션 컨텍스트는 그 자체로 ApplicationContext인터페이스를 구현한 오브젝트를 가리키기도 하는데, 애플리케이션 컨텍스트 오브젝트는 하나의 애플리케이션에서 보통 여러개가 만들어져 사용된다. 이를 통틀어서 스프링 컨테이너라고 부를 수 있다.
- 스프링 컨테이너는 IoC컨테이너일 뿐 아니라, 고전적인 싱글톤 패턴을 대신해서 싱글톤을 만들고 관리해주는 싱글톤 레지스트리 이다.
- **스프링 컨테이너란 IoC/DI 방식으로 빈을 생성, 관리하는 빈 팩토리 개념을 넘어 스프링이 제공하는 지원 기능을 모두 포함하는 것을 말한다.**

### 싱글톤 레지스트리 (singletone registry)
- 스프링이 직접 싱글톤 형태의 오브젝트를 만들고 관리하는 기능을 제공하는 것
- 자바의 기본적인 싱글톤 패턴의 구현 방식은 여러 단점(스태틱 메소드와 private 생성자를 사용)이 있기 때문에 스프링은 직접 싱글톤을 관리
- 싱글톤 레지스트리의 장점은 스태틱 메소드와 private 생성자를 사용해야하는 클래스가 아니라 평범한 자바 클래스를 싱글톤으로 활용하게 해준다.
- IoC방식으로 오브젝트를 관리하는 애플리케이션 컨텍스트가 이러한 기능을 제공한다.
- 소스를 전부 까보지는 않았지만 스윽 보니 스프링에서는 싱글톤을 ConcurrentHashMap을 이용해서 관리하는 것 같더라.

> 자바의 싱글톤 패턴의 한계 : 
> private 생성자를 갖고 있기 때문에 상속할 수 없다. 객체지향의 장점인 상속과 이를 이용한 다형성의 사용이 불가능하다. 
> 싱글톤은 테스트하기가 힘들다. 테스트에서 사용될 목 오브젝트 등으로 대체하기가 힘들다. 생성자를 통해 주입이 불가능하기 때문에 테스트를 위한 직접 오브젝트를 만들어서 사용할 수 밖에 없다.
> 서버환경에서는 싱글톤이 하나만 만들어지는 것을 보장하지 못한다. 
> 싱글톤의 사용은 전역 상태를 만들 수 있기 때문에 바람직하지 못하다.
> 아래 소스는 자바의 싱글톤 패턴을 만드는 방법 중 하나이다. 

```java
public class ThreadSafeSynchronized {
	private static ThreadSafeSynchronized instance;
	
	private ThreadSafeSynchronized() {}
	
	public static ThreadSafeSynchronized getInstance() {
		if(instance == null) {
			synchronized(ThreadSafeSynchronized.class) {
				if(instance == null) {
					instance = new ThreadSafeSynchronized();	
				}
			}
		}
		return instance;
	}
}
```


### 스프링 빈의 스코프
- 스프링이 관리하는 오브젝트(=빈)가 생성되고 존재하고 적용되는 범위를 빈의 스코프 라고 한다.
- 스프링 빈의 기본 스코프는 싱글톤이다. 싱글톤 스코프는 컨테이너 내에 한 개의 오브젝트만 만들어져서 강제로 제거하지 않는 한 스프링 컨테이너가 존재하는 동안 계속 유지된다.
- 경우에 따라 다른 스코프를 갖게 할 수 있다.
  * 프로토타입(prototype) 스코프 : 컨테이너에 빈을 요청할 때마다 매번 새로운 오브젝트를 만들어준다
  * 요청(request) 스코프 : 웹을 통해 새로운 HTTP요청이 생길때마다 오브젝트가 생성된다.
  * 세션(session) 스코프 : 웹의 세션과 유사한 스코프 

